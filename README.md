# LockFile-Poc

with UM_IRP_OK and LOCKFILE_EXCLUSIVE_LOCK|LOCKFILE_FAIL_IMMEDIATELY:

145c>UM_IRP::UM_IRP<000001D09B125A00>
b74>UM_IRP::UM_IRP<000001D09B13E150>
280> !! UM_IRP::IoCompletionNT<000001D09B13E150>(c0000055, 0000000000000000)
280>UM_IRP::IoCompletionWin32<000001D09B13E150>(21, 0000000000000000)
10ac> !! UM_IRP::IoCompletionNT<000001D09B125A00>(0, 0000000000000000)
10ac>UM_IRP::IoCompletionWin32<000001D09B125A00>(0, 0000000000000000)
280>UM_IRP::~UM_IRP<000001D09B13E150>
10ac>UM_IRP::~UM_IRP<000001D09B125A00>
The thread 'Win64 Thread' (0xb74) has exited with code 0 (0x0).

======== unlock ======
145c>UM_IRP::UM_IRP<000001D09B148850>
The thread 'Win64 Thread' (0x145c) has exited with code 0 (0x0).


with UM_IRP_WRONG and LOCKFILE_EXCLUSIVE_LOCK|LOCKFILE_FAIL_IMMEDIATELY:

eb4>UM_IRP::UM_IRP<0000023D96A9D360>
534>UM_IRP::UM_IRP<0000023D96A5B1A0>
534>UM_IRP::IoCompletionWin32<0000023D96A5B1A0>(21, 0)
1974> !! UM_IRP::IoCompletionNT<0000023D96A5B1A0>(c0000055, 0000000000000000)
534>UM_IRP::~UM_IRP<0000023D96A5B1A0>
1974>UM_IRP::IoCompletionWin32<0000023D96A5B1A0>(21, 0000000000000000)
36c> !! UM_IRP::IoCompletionNT<0000023D96A9D360>(0, 0000000000000000)
36c>UM_IRP::IoCompletionWin32<0000023D96A9D360>(0, 0000000000000000)
First-chance exception at 0x00007ff6ed4c5f1f in poc.exe: 0xC0000005: Access violation reading location 0xffffffffffffffff.
36c>UM_IRP::~UM_IRP<0000023D96A9D360>
Unhandled exception at 0x00007ff6ed4c5f1f in poc.exe: 0xC0000005: Access violation reading location 0xffffffffffffffff.


with UM_IRP_WRONG and LOCKFILE_EXCLUSIVE_LOCK:

6f4>UM_IRP::UM_IRP<000001E6CF67D1A0>
1508>UM_IRP::UM_IRP<000001E6CF67DD80>
1b68> !! UM_IRP::IoCompletionNT<000001E6CF67D1A0>(0, 0000000000000000)
1b68>UM_IRP::IoCompletionWin32<000001E6CF67D1A0>(0, 0000000000000000)
1b68>UM_IRP::~UM_IRP<000001E6CF67D1A0>

======== unlock ======
6f4>UM_IRP::UM_IRP<000001E6CF668380>
1b68> !! UM_IRP::IoCompletionNT<000001E6CF67DD80>(0, FFFFE3882AEDE010)
1b68>UM_IRP::IoCompletionWin32<000001E6CF67DD80>(0, FFFFE3882AEDE010)
1b68>UM_IRP::~UM_IRP<000001E6CF67DD80>

======== unlock ======
1508>UM_IRP::UM_IRP<000001E6CF696DA0>
The thread 'Win64 Thread' (0x6f4) has exited with code 0 (0x0).
The thread 'Win64 Thread' (0x1508) has exited with code 0 (0x0).


with UM_IRP_OK and LOCKFILE_EXCLUSIVE_LOCK:

15c0>UM_IRP::UM_IRP<00000244553440B0>
1194>UM_IRP::UM_IRP<000002445538E150>
2f4> !! UM_IRP::IoCompletionNT<00000244553440B0>(0, 0000000000000000)
2f4>UM_IRP::IoCompletionWin32<00000244553440B0>(0, 0000000000000000)
2f4>UM_IRP::~UM_IRP<00000244553440B0>

======== unlock ======
15c0>UM_IRP::UM_IRP<000002445534B150>
2f4> !! UM_IRP::IoCompletionNT<000002445538E150>(0, FFFFE3882AEDE010)
2f4>UM_IRP::IoCompletionWin32<000002445538E150>(0, FFFFE3882AEDE010)
2f4>UM_IRP::~UM_IRP<000002445538E150>

======== unlock ======
1194>UM_IRP::UM_IRP<00000244553A6040>
The thread 'Win64 Thread' (0x1194) has exited with code 0 (0x0).
The thread 'Win64 Thread' (0x15c0) has exited with code 0 (0x0).

---------------------------------------------------------------------
// value FFFFE3882AEDE010 returned in iosb.Information in case LockFileEx return pending status
